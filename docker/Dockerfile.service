FROM python:3.12.3-slim

WORKDIR /app

ENV UV_PROJECT_ENVIRONMENT="/usr/local/"
ENV UV_COMPILE_BYTECODE=1

COPY pyproject.toml ./
COPY uv.lock ./
COPY requirements.txt ./
RUN pip install --no-cache-dir uv
RUN uv sync --frozen --no-install-project --no-dev
RUN uv pip install --system -r requirements.txt

# Copy source code
COPY src/ ./src/

EXPOSE 80

ENV PYTHONPATH=/app

CMD ["python", "src/run_service.py"]
