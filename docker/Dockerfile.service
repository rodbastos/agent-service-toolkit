FROM python:3.12.3-slim

# Set the working directory to the src folder
WORKDIR /opt/render/project/src

# Set Python path to include the current directory
ENV PYTHONPATH=/opt/render/project/src:$PYTHONPATH
ENV UV_PROJECT_ENVIRONMENT="/usr/local/"
ENV UV_COMPILE_BYTECODE=1

# Copy the entire project
COPY . /opt/render/project/src/

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

EXPOSE 80

# Set the default command with the correct module path
CMD ["gunicorn", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", "service.service:app"]
