FROM python:3.12.3-slim

# Create and set the working directory
WORKDIR /app

# Copy the entire project
COPY . /app/

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Add src directory to Python path
ENV PYTHONPATH=/app/src

# Move to src directory where the service is located
WORKDIR /app/src

EXPOSE 80

# Debug: List contents to verify files
RUN ls -la /app/src/service/

# Set the default command
CMD ["gunicorn", "--chdir", "/app/src", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", "--bind", "0.0.0.0:80", "service.service:app"]
