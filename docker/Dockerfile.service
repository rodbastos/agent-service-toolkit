FROM python:3.12.3-slim

# Set the working directory
WORKDIR /opt/render/project/src

# Copy only necessary files first
COPY requirements.txt .
COPY pyproject.toml .
COPY uv.lock .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy the source code
COPY src/ .

# Debug: Print working directory and list contents
RUN pwd && ls -la

# Set environment variables
ENV PYTHONPATH=/opt/render/project/src
ENV PORT=80

EXPOSE 80

# Set the default command with module path
CMD ["gunicorn", "service.service:app", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", "--bind", "0.0.0.0:80", "--pythonpath", "/opt/render/project/src"]
